layui.use(['table','form'], function(){
  var table = layui.table;
  var form = layui.form;
  var beforeURL = "/muda";

  //方法级渲染
  csvo = table.render({
    elem: '#LAY_table_user'
    ,url: beforeURL+'/project/get'
    ,toolbar: '#toolbarDemo'
    ,title: '用户数据表'
    ,request:{
        pageName:'pageNum' // 页码的参数名称，默认：page
        ,limitName:'pageSize' //每页数据量的参数名，默认：limit
    }
    ,response: {
        statusName: 'code', //数据状态的字段名称，默认：code
        statusCode: 200, //成功的状态码，默认：0
        msgName: 'msg', //状态信息的字段名称，默认：msgz
        countName: 'count', //数据总数的字段名称，默认：count
        dataName: 'data' //数据列表的字段名称，默认：data
    }
    ,cols: [
     [
      {checkbox: true, fixed: true}
      ,{field:'id', title: 'ID', width:80, sort: true, fixed: true}
      ,{field:'projectName', title: '项目名称',sort: true, width:120, fixed: true}
      ,{field:'caseCode', title: 'caseID', sort: true, width:120, fixed: true}
      ,{field:'status', title:'状态', width:80, templet: '#switchDemo', unresize: true}
      ,{field:'mockAdress', title: 'mock地址',sort: true, width:150}
      ,{field:'updateTime', title: '更新时间', sort: true, width:150, templet:"<div>{{layui.util.toDateString(d.updateTime,'yyyy-MM-dd HH:mm:ss')}}</div>"}
      ,{field:'author', title: '操作者',width:80}
      ,{field:'mMsg', title: '项目说明'}
      ,{fixed:'right',title:"操作",align:"center",toolbar:'#barDemo',width:180}
     ]
    ]
    ,id: 'testReload'
    ,page: true
    ,height: 600
    ,even: true //开启隔行背景
  });

 //监听表格复选框选择
  table.on('checkbox(demo)', function(obj){
    console.log(obj)
  });
  //监听工具条
  table.on('tool(demo)', function(obj){
    var data = obj.data;
    if(obj.event === 'detail'){
      layer.msg('ID：'+ data.id + ' 的查看操作');
    } else if(obj.event === 'del'){
      layer.confirm('真的删除行么', function(index){
//        obj.del();
          dele(data);
        layer.close(index);
      });
    } else if(obj.event === 'edit'){
      layer.alert('编辑行：<br>'+ JSON.stringify(data));

      openWin(data,'修改信息','/come/editEmployee.html',600,400);
//      layui.form.render(); //更新全部
//      layui.form.render('select'); //刷新select选择框渲染
      layui.form.render('radio','gender');

    }

  });

  var $ = layui.$, active = {
    getCheckData: function(){ //获取选中数据
      var checkStatus = table.checkStatus('testReload')
      ,data = checkStatus.data;
      layer.alert(JSON.stringify(data));
    }
    ,getCheckLength: function(){ //获取选中数目
      var checkStatus = table.checkStatus('testReload')
      ,data = checkStatus.data;
      layer.msg('选中了：'+ data.length + ' 个');
    }
    ,isAll: function(){ //验证是否全选
      var checkStatus = table.checkStatus('testReload');
      layer.msg(checkStatus.isAll ? '全选': '未全选');
    }
    ,reload: function(){
      var demoReload = $('#demoReload');
      console.log("oooooo----"+demoReload.val());
      //执行重载
      table.reload('testReload', {
        pageNum: {
          curr: 1 //重新从第 1 页开始
        }
        ,where: {
            projectName: demoReload.val()
        }
      }, 'data');
    }
  };


   // 可以用于修改swtch标签
    function dele(data) {
        $.ajax({
            url: beforeURL+'/emp/delete',
            type: 'post',
            dataType: 'json',
            //contentType: 'application/json;charset=utf-8',
            //此处如果是json格式，只传ID的话后台收不到参数
            contentType: 'application/x-www-form-urlencoded',
            data: {
                    'id': data.id
                  },
            success: function (data1) {
//                  alert('delete success'+data1);
                  // 重新加载
                  location.reload(true);

            }
        })
    };

//定义打开自窗口方法
function openWin(editData,title,url,w,h,full) {
  		if (title == null || title == '') {
  	        var title=false;
  	    };
  	    if (url == null || url == '') {
  	        var url="404.html";
  	    };
  	    if (w == null || w == '') {
  	        var w=($(window).width()*0.9);
  	    };
  	    if (h == null || h == '') {
  	        var h=($(window).height() - 50);
  	    };
  	    var index = layer.open({
  	        type: 2,
  	        area: [w+'px', h +'px'],
  	        fix: false, //不固定
  	        maxmin: true,
  	        shadeClose: true,
  	        shade:0.4,
  	        title: title,
  	        content: url,
  	        //打开窗口并传值过去
  	        success: function(layero,index){
  	            var body =  layer.getChildFrame('body',index);
                body.find("input[name='id']").val(editData.id);
  	            body.find("input[name='lastName']").val(editData.lastName);
  	            body.find("input[name='email']").val(editData.departmentId);
                body.find("input[name='gender'][value='"+editData.gender+"']").attr('checked', 'true');
  	            body.find("input[name='birth']").val(layui.util.toDateString(editData.birth, "yyyy-MM-dd"));
  	            body.find("#selectO option[value="+editData.departmentId+"]").attr('selected', 'true');
  	        }
  	    });
  	    if(full){
  	       layer.full(index);
  	    }
  }



//监听switch操作
  form.on('switch(switchDemo)', function(obj){

    var params = {id:obj.value,status:obj.elem.checked?1:0};
    console.log(params);
        $.ajax({
            url: beforeURL+'/project/update',
            type : 'post',
            dataType: 'text',
            contentType: 'application/json;charset=utf-8',
            data: JSON.stringify(params),
            success : function (data1) {
                alert(11111111);
            }
          });

    layer.tips(this.value + ' ' + this.name + '：'+ obj.elem.checked, obj.othis);
    return false;
  });


  $('.demoTable .layui-btn').on('click', function(){
    var type = $(this).data('type');
    active[type] ? active[type].call(this) : '';
  });

});

